best_lambda, best_alpha, best_beta, best_rho))
# ç”¨æœ€ä¼˜å‚æ•°è®­ç»ƒæœ€ç»ˆç½‘ç»œ
final_network <- learn_network_improved(
N1 = N1, N2 = N2, expr = expr,
lambda = best_lambda, alpha = best_alpha, beta = best_beta, rho = best_rho,
max_iter = max_iter
)
# è®¡ç®—æœ€ç»ˆç½‘ç»œè¾¹æ•°
final_edges <- sum(final_network) / 2
cat(sprintf("æœ€ç»ˆç½‘ç»œå®é™…è¾¹æ•°: %d\n", final_edges))
cat("======================================================\n")
return(list(
network = final_network,
params = list(lambda = best_lambda, alpha = best_alpha, beta = best_beta, rho = best_rho),
actual_edges = final_edges
))
}
# ç½‘ç»œæ€§èƒ½è¯„ä¼°ï¼ˆè¾“å‡ºTPR/F1/è¾¹æ•°åå·®ç­‰å®Œæ•´æŒ‡æ ‡ï¼‰
evaluate_network_performance <- function(net, Y_true, Y_ppi, target_edges = NULL) {
if (sum(net) == 0) {
warning("ç½‘ç»œæ— ä»»ä½•è¾¹ï¼Œæ€§èƒ½æŒ‡æ ‡å‡ä¸º0")
return(list(
TPR = 0, FPR = 0, Precision = 0, F1 = 0, PPI_Overlap = 0,
TP = 0, FP = 0, FN = 0,
Actual_Edges = 0, Target_Edges = target_edges, Edge_Deviation = NA
))
}
# åŸºç¡€å‚æ•°è®¡ç®—
n_genes <- nrow(Y_true)
total_possible_edges <- n_genes * (n_genes - 1) / 2  # æ— å‘å›¾æœ€å¤§è¾¹æ•°
true_edges <- sum(Y_true) / 2                        # çœŸå®ç½‘ç»œè¾¹æ•°
ppi_edges <- sum(Y_ppi) / 2                          # PPIç½‘ç»œè¾¹æ•°
actual_edges <- sum(net) / 2                         # é¢„æµ‹ç½‘ç»œè¾¹æ•°
# æ··æ·†çŸ©é˜µæŒ‡æ ‡
tp <- sum(net & Y_true) / 2    # çœŸé˜³æ€§è¾¹ï¼ˆé¢„æµ‹å¯¹çš„çœŸå®è¾¹ï¼‰
fp <- sum(net & !Y_true) / 2   # å‡é˜³æ€§è¾¹ï¼ˆé¢„æµ‹é”™çš„éçœŸå®è¾¹ï¼‰
fn <- true_edges - tp          # å‡é˜´æ€§è¾¹ï¼ˆæ²¡é¢„æµ‹åˆ°çš„çœŸå®è¾¹ï¼‰
# æ€§èƒ½æŒ‡æ ‡
tpr <- if (true_edges > 0) tp / true_edges else 0  # å¬å›ç‡/TPR
fpr <- if ((total_possible_edges - true_edges) > 0) {
fp / (total_possible_edges - true_edges)  # å‡é˜³æ€§ç‡
} else 0
precision <- if ((tp + fp) > 0) tp / (tp + fp) else 0  # ç²¾ç¡®åº¦
f1 <- if ((precision + tpr) > 0) 2 * precision * tpr / (precision + tpr) else 0  # F1åˆ†æ•°
ppi_overlap <- if (ppi_edges > 0) sum(net & Y_ppi) / ppi_edges else 0  # ä¸PPIç½‘ç»œé‡å ç‡
# è¾¹æ•°åå·®ï¼ˆç›¸å¯¹åå·®ï¼‰
edge_deviation <- if (!is.null(target_edges)) {
abs(actual_edges - target_edges) / (target_edges + 1e-6)
} else NA
# è¿”å›å®Œæ•´æ€§èƒ½æŒ‡æ ‡
return(list(
TPR = tpr, FPR = fpr, Precision = precision, F1 = f1, PPI_Overlap = ppi_overlap,
TP = tp, FP = fp, FN = fn,
Actual_Edges = actual_edges, Target_Edges = target_edges, Edge_Deviation = edge_deviation
))
}
sum(Y_ppi)/2
sum(X_data)/2
sum(X_data_t)/2
1000*999/2
dim(expr)
cat(sprintf("\nå¼€å§‹è´å¶æ–¯ä¼˜åŒ–ï¼ˆåˆå§‹éšæœºç‚¹%dä¸ªï¼Œå¼•å¯¼è¿­ä»£%dæ¬¡ï¼‰...\n", init_points, n_iter))
# ---------------------- ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®ä¼˜åŒ–å‚æ•°ï¼ˆç”¨æˆ·å¯è°ƒæ•´ï¼‰ ----------------------
# è´å¶æ–¯ä¼˜åŒ–å‚æ•°
init_points <- 5    # åˆå§‹éšæœºæŠ½æ ·ç‚¹æ•°ï¼ˆå»ºè®®5-20ï¼Œè¶Šå¤šè¶Šç¨³ä½†è¶Šæ…¢ï¼‰
n_iter <- 30        # ä»£ç†æ¨¡å‹å¼•å¯¼è¿­ä»£æ¬¡æ•°ï¼ˆå»ºè®®20-50ï¼‰
kappa <- 1.96       # æ¢ç´¢-åˆ©ç”¨æƒè¡¡ï¼ˆé»˜è®¤1.96ï¼Œè¶Šå¤§è¶Šåå‘æ¢ç´¢ï¼‰
parallel_cores <- 10  # å¹¶è¡Œæ ¸å¿ƒæ•°ï¼ˆæ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´ï¼Œæœ€å¤§ä¸è¶…è¿‡CPUæ ¸å¿ƒæ•°ï¼‰
# è¾¹æ•°çº¦æŸå‚æ•°
target_edges <- 1500  # ç›®æ ‡è¾¹æ•°ï¼ˆç”¨æˆ·æ ¸å¿ƒéœ€æ±‚ï¼šå¸Œæœ›æœ€ç»ˆç½‘ç»œæœ‰å¤šå°‘æ¡è¾¹ï¼‰
edge_penalty_weight <- 2  # è¾¹æ•°æƒ©ç½šæƒé‡ï¼ˆè¶Šå¤§è¶Šä¸¥æ ¼ï¼Œå»ºè®®1-5ï¼‰
# ç½‘ç»œè®­ç»ƒå‚æ•°
admm_max_iter <- 30  # æœ€ç»ˆç½‘ç»œADMMè¿­ä»£æ¬¡æ•°ï¼ˆå»ºè®®20-100ï¼‰
# 1. åˆ›å»ºä¼˜åŒ–å‡½æ•°ï¼ˆä»…æ¥å—å¾…ä¼˜åŒ–å‚æ•°lambda/alpha/beta/rhoï¼Œå…¶ä»–å‚æ•°é€šè¿‡ç¯å¢ƒä¼ é€’ï¼‰
optim_fun <- function(lambda, alpha, beta, rho) {
evaluate_network(
lambda = lambda, alpha = alpha, beta = beta, rho = rho,
N1 = X_data_t, N2 = Y_ppi, expr = expr, Y_true = X_data_true, Y_ppi = Y_ppi,
target_edges = target_edges, edge_penalty_weight = edge_penalty_weight
)
}
# 2. è®¾ç½®å¾…ä¼˜åŒ–å‚æ•°çš„æœç´¢èŒƒå›´ï¼ˆåŸå§‹å€¼ï¼Œåç»­åœ¨evaluate_networkä¸­è½¬æ¢ï¼‰
param_bounds <- list(
lambda = c(-3, 3),    # è½¬æ¢åï¼š~0.05-20
alpha = c(-5, 5),     # è½¬æ¢åï¼š~0.007-0.993
beta = c(-5, 5),      # è½¬æ¢åï¼š~0.007-0.993
rho = c(-2, 2)        # è½¬æ¢åï¼š~0.14-7.39
)
# 3. è°ƒæ•´å‚æ•°èŒƒå›´é¿å…æç«¯å€¼
adjusted_bounds <- lapply(param_bounds, function(x) c(max(x[1], -10), min(x[2], 10)))
# 4. å¹¶è¡Œæ‰§è¡Œè´å¶æ–¯ä¼˜åŒ–
cl <- makeCluster(5)
registerDoParallel(cl)
on.exit(stopCluster(cl))  # é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­å¹¶è¡Œé›†ç¾¤
set.seed(123)  # å›ºå®šç§å­ç¡®ä¿å¯é‡å¤
optim_result <- BayesianOptimization(
FUN = optim_fun,
bounds = adjusted_bounds,
init_points = init_points,
n_iter = n_iter,
acq = "ei",  # æœŸæœ›æ”¹è¿›ç®—æ³•ï¼ˆå¸¸ç”¨ï¼‰
kappa = kappa,
verbose = TRUE  # æ‰“å°æ¯ä¸€æ­¥ä¼˜åŒ–ç»“æœ
)
init_points <- 10    # åˆå§‹éšæœºæŠ½æ ·ç‚¹æ•°ï¼ˆå»ºè®®5-20ï¼Œè¶Šå¤šè¶Šç¨³ä½†è¶Šæ…¢ï¼‰
n_iter <- 30        # ä»£ç†æ¨¡å‹å¼•å¯¼è¿­ä»£æ¬¡æ•°ï¼ˆå»ºè®®20-50ï¼‰
kappa <- 1.96       # æ¢ç´¢-åˆ©ç”¨æƒè¡¡ï¼ˆé»˜è®¤1.96ï¼Œè¶Šå¤§è¶Šåå‘æ¢ç´¢ï¼‰
parallel_cores <- 10  # å¹¶è¡Œæ ¸å¿ƒæ•°ï¼ˆæ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´ï¼Œæœ€å¤§ä¸è¶…è¿‡CPUæ ¸å¿ƒæ•°ï¼‰
# è¾¹æ•°çº¦æŸå‚æ•°
target_edges <- 1500  # ç›®æ ‡è¾¹æ•°ï¼ˆç”¨æˆ·æ ¸å¿ƒéœ€æ±‚ï¼šå¸Œæœ›æœ€ç»ˆç½‘ç»œæœ‰å¤šå°‘æ¡è¾¹ï¼‰
edge_penalty_weight <- 2  # è¾¹æ•°æƒ©ç½šæƒé‡ï¼ˆè¶Šå¤§è¶Šä¸¥æ ¼ï¼Œå»ºè®®1-5ï¼‰
# ç½‘ç»œè®­ç»ƒå‚æ•°
admm_max_iter <- 30  # æœ€ç»ˆç½‘ç»œADMMè¿­ä»£æ¬¡æ•°ï¼ˆå»ºè®®20-100ï¼‰
# ---------------------- ç¬¬å››æ­¥ï¼šæ‰§è¡Œè´å¶æ–¯ä¼˜åŒ–ï¼ˆå¯»æ‰¾æœ€ä¼˜å‚æ•°ï¼‰ ----------------------
cat(sprintf("\nå¼€å§‹è´å¶æ–¯ä¼˜åŒ–ï¼ˆåˆå§‹éšæœºç‚¹%dä¸ªï¼Œå¼•å¯¼è¿­ä»£%dæ¬¡ï¼‰...\n", init_points, n_iter))
# 1. åˆ›å»ºä¼˜åŒ–å‡½æ•°ï¼ˆä»…æ¥å—å¾…ä¼˜åŒ–å‚æ•°lambda/alpha/beta/rhoï¼Œå…¶ä»–å‚æ•°é€šè¿‡ç¯å¢ƒä¼ é€’ï¼‰
optim_fun <- function(lambda, alpha, beta, rho) {
evaluate_network(
lambda = lambda, alpha = alpha, beta = beta, rho = rho,
N1 = X_data_t, N2 = Y_ppi, expr = expr, Y_true = X_data_true, Y_ppi = Y_ppi,
target_edges = target_edges, edge_penalty_weight = edge_penalty_weight
)
}
# 2. è®¾ç½®å¾…ä¼˜åŒ–å‚æ•°çš„æœç´¢èŒƒå›´ï¼ˆåŸå§‹å€¼ï¼Œåç»­åœ¨evaluate_networkä¸­è½¬æ¢ï¼‰
param_bounds <- list(
lambda = c(-3, -1),    # è½¬æ¢åï¼š~0.05-20
alpha = c(-5, 5),     # è½¬æ¢åï¼š~0.007-0.993
beta = c(-5, 5),      # è½¬æ¢åï¼š~0.007-0.993
rho = c(-2, 2)        # è½¬æ¢åï¼š~0.14-7.39
)
# 3. è°ƒæ•´å‚æ•°èŒƒå›´é¿å…æç«¯å€¼
adjusted_bounds <- lapply(param_bounds, function(x) c(max(x[1], -10), min(x[2], 10)))
# 4. å¹¶è¡Œæ‰§è¡Œè´å¶æ–¯ä¼˜åŒ–
cl <- makeCluster(5)
registerDoParallel(cl)
on.exit(stopCluster(cl))  # é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­å¹¶è¡Œé›†ç¾¤
set.seed(123)  # å›ºå®šç§å­ç¡®ä¿å¯é‡å¤
optim_result <- BayesianOptimization(
FUN = optim_fun,
bounds = adjusted_bounds,
init_points = init_points,
n_iter = n_iter,
acq = "ei",  # æœŸæœ›æ”¹è¿›ç®—æ³•ï¼ˆå¸¸ç”¨ï¼‰
kappa = kappa,
verbose = TRUE  # æ‰“å°æ¯ä¸€æ­¥ä¼˜åŒ–ç»“æœ
)
1000*999/2*0.01
source("D:/Academic/A_Molecular_Interaction_Tree/Code/MCMC_Function_æ–°å¹¶è¡Œ_æ±‡æ€»å–å¹³å‡æ¦‚ç‡_ç”µè„‘ç‰ˆ.R")
packages <- c("lme4","arm","withr","ggplot2","tidyr","ggstats", "GGally", "sna","parallel","foreach","doParallel","iterators","dplyr","igraph","mclust")
#dir <- "/mnt/sda/maoshanjun/liusixuan/packages"
for (pkg in packages) {
library(pkg, character.only = TRUE)
}
# source("/mnt/sda/maoshanjun/liusixuan/Parallel/MCMC_Function_æ–°å¹¶è¡Œ_æ±‡æ€»å–å¹³å‡æ¦‚ç‡_æœåŠ¡å™¨ç‰ˆ.R")
set.seed(1234)
##-------------Parameter-------------------
g <- 1000;domain <- 3 #gæ˜¯åŸºå› ä¸ªæ•°
m1 <- 10 #èšç±»
m2 <- 30 #é‡å¤éšæœº
#PPI
interact_prob <- 0.8 #çœŸå®æ•°æ®ä¸ºppiçš„æ¦‚ç‡
X_p_true <- 1      #PPIé‡Œç™¾åˆ†ç™¾çœŸå®çš„æ¦‚ç‡
#expr
expr_mean <- c(0.7,0);sd <- 0.1 #ç›¸å…³ç³»æ•°
exprmean <- 0;exprsd <- 1;
n_samples=500 #åŸºå› è¡¨è¾¾é‡ä¸ªæ•°
#D
p_marginal <- 0.1   #å‡ºç°è¾¹é™…åŸºå› çš„æ¦‚ç‡
maxdomain <- 2      #è¾¹é™…åŸºå› æœ€å¤šå‡ºç°åœ¨2ä¸ªåŒºåŸŸ
D_p_true <- rep(0.5,4) #Dæ•°æ®æ˜¯çœŸå®çš„æ¯”ä¾‹
#çœŸå®è¿æ¥
ita <- 0.02 #X_dataç¨€ç–
sim_prob <- 0.03 #X_simç¨€ç–[è®¾åˆå§‹è¿­ä»£å€¼ç”¨çš„ï¼Œå¯ä¸ç®¡]
#MCMC
num_iter=100    #è¿­ä»£æ¬¡æ•°
iter_size=50    #å–æœ€åå¤šå°‘æ¬¡ç»“æœè¿›è¡Œæ±‡æ€»çœ‹å¹³å‡ç»“æœ
X_thresP=(1/2);D_thresP=(1/2)
kappa <- 3; delta <- 2 #Update
selected_p <- c(0.2,0.05)
#pert
change_prob <- c(0.5,0.01) #ç¬¬1ä¸ªæ˜¯æœ‰è¾¹â†’æ— è¾¹çš„æ¦‚ç‡ï¼›ç¬¬2ä¸ªæ˜¯æ— è¾¹â†’å³è¾¹æ¦‚ç‡
##--------------Data----------------
data <- gen_data(g,domain,p_marginal,maxdomain,
D_p_true=D_p_true,X_p_true=X_p_true,ita=ita,
interact_prob,expr_mean,sd,n_samples = n_samples,
exprmean = exprmean, exprsd = exprsd,
ifpert=F,change_prob=change_prob,sim_prob = sim_prob)
D <- data$D
D_true <- data$D_true
X_data <- data$X_data
X_data_true <- data$X_data_true
Y_ppi <- data$Y_ppi
Y_expr <- data$Y_expr
expr <- data$expr
Y_expr_t <- data$Y_expr_t
expr <- t(expr)
Y_expr_0 <- cor(t(expr))
diag(Y_expr_0) <- 0
X_data_sim <- data$X_data_sim
# Y_expr_1 <- sign(Y_expr_0)*((Y_expr_0)^2)
# diag(Y_expr_0) <- 0
# diag(Y_expr_1) <- 0
D_t <- D_true
save(list = ls(),file="g1000_random_æ•°æ®_èšç±»_12345_ç¨€ç–002.RData")
#----------Pre-set NewData(Cluster)-----------------------------------
A_model <- Mclust(expr)
cluster <- A_model$classification
An <- nrow(expr)
X_data_sm <- matrix(0,An,An)
for (i in 1:(An-1)) {
for (j in (i+1):An) {
if (cluster[i] == cluster[j]) {
# åŒä¸€ç±»ï¼Œä¸º1çš„æ¦‚ç‡ä¸º0.8
X_data_sm[i, j] <- ifelse(runif(1) < sim_prob, 1, 0)
} else {
# ä¸åŒç±»ï¼Œä¸º1çš„æ¦‚ç‡ä¸º0.05
#ALL_X_sim[i, j] <- ifelse(runif(1) < 0.1, 1, 0)
}
# ç¡®ä¿å¯¹ç§°æ€§
X_data_sm[j, i] <- X_data_sm[i, j]
}
}
diag(X_data_sm) <- 0
X_data_sm <- as.matrix(X_data_sm )
X_data_sim <- 1L *(X_data_sm | X_data_true)
X_data_t <- X_data_sim
save(list = ls(),file="g1000_random_æ•°æ®_èšç±»_12345_ç¨€ç–002.RData")
dim(expr)
print("å‚æ•°è®¾ç½®å®Œ")
g5000_m100_iter00 <- Sys.time()
print(paste("å‡†å¤‡æ›´æ–°ï¼š",Sys.time()))
result <- parallel_network_learning(num_iter=num_iter,iter_size=iter_size,
X_thresP=X_thresP,D_thresP=D_thresP,
domain=domain,kappa=kappa,delta=delta,
X_data_t=X_data_sim,X_data_true=X_data_true,
D_t=D_t,D_true=D_true,Y_ppi=Y_ppi,Y_expr=Y_expr_0,
m=m1,m_2=m2,cores=10,expr=t(expr))
print(paste("ç»“æŸæ›´æ–°ï¼š",Sys.time()))
X_data_t <- result$X_data_t;D_t <- result$D_t
X_data_t0 <- result$X_data_t0;D_t0=result$D_t0
X_data_last <- result$X_data_last;D_last <- result$D_last
diff_D_all <- result$diff_D_all
g5000_m100_iter300 <- Sys.time()
save(list = ls(),file = "g1000_æ–°å¹¶è¡Œ_èšç±»æŠ½æ ·å–æ±‡æ€»æ¦‚ç‡_æ¨¡æ‹Ÿ_m10m30_12345_ç¨€ç–002.RData")
sim1 <- sim_eval(X_data_true=X_data_true,X_data_t,X_data=X_data,D=D,D_t=D_t,D_true =D_true,
ifpert=FALSE)
save(list = ls(),file = "g1000_æ–°å¹¶è¡Œ_èšç±»æŠ½æ ·å–æ±‡æ€»æ¦‚ç‡_æ¨¡æ‹Ÿ_m10m30_12345_ç¨€ç–002.RData")
sum(X_data)/2
sum(X_data_t)/2
sum(X_data_t & X_data)/2
cout_0 <- 1
library(readxl)
library(dplyr)
library(openxlsx)
expr <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡æ•°æ®.csv")
expr <- as.data.frame(expr)
count_0 <- apply(expr,1,function(x){return(sum(x==0))})
delete <- which(count_0 > (length(expr)*(2/3))) #ç­›æ‰åŸºå› è¡¨è¾¾é‡2/3ä¸º0çš„
View(expr)
rownames(expr) <- expr[1,]
colnames(expr) <- expr[1,]
View(expr)
expr <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡æ•°æ®.csv")
rownames(expr) <- expr[,1]
View(expr)
expr <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡æ•°æ®.csv")
expr <- as.data.frame(expr)
rownames(expr) <- expr[,1]
View(expr)
dim(expr[,1])
expr[,1]
expr <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡æ•°æ®.csv")
d <- expr[,1]
d1 <- unique(d)
class(d)
c <- duplicated(d)
e <- d[c]
e
which(d==e,drop==F)
which(d==e[1])
expr <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡æ•°æ®.csv")
expr <- as.data.frame(expr)
rownames(expr) <- expr[,1]
count_0 <- apply(expr,1,function(x){return(sum(x==0))})
expr <- expr[,-1,drop=F]
View(expr)
count_0 <- apply(expr,1,function(x){return(sum(x==0))})
delete <- which(count_0 > (length(expr)*(2/3))) #ç­›æ‰åŸºå› è¡¨è¾¾é‡2/3ä¸º0çš„
expr_filter <- expr[delete,]
delete <- which(count_0 > (length(expr)*(4/5))) #ç­›æ‰åŸºå› è¡¨è¾¾é‡2/3ä¸º0çš„
expr_filter <- expr[delete,]
write.xlsx(expr_filter, "D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡_ç­›.csv")
library(scImpute)
scimpute(
count_path = "D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\è¡¨è¾¾é‡_ç­›.csv",
infile = "csv",           # format of input file
outfile = "csv",          # format of output file
out_dir = "D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\é›¶è†¨èƒ€",           # full path to output directory
labeled = FALSE,          # cell type labels not available
drop_thre = 0.7,          # threshold set on dropout probability
Kcluster = 3,             # 2 cell subpopulations
ncores = 1 ,             # number of cores used in parallel computation
)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(c("AUCell", "RcisTarget", "GENIE3"))
if (!requireNamespace("devtools", quietly = TRUE))
install.packages("devtools")
devtools::install_github("aertslab/SCENIC")
library(WGCNA)
BiocManager::install("GO.db")
expr_b <- read.csv(file = "D:\\Academic\\A_Molecular_Interaction_Tree\\Data\\äººä½“æ³›ç»„ç»‡\\Stomach_top2000_normalized_expression.csv")
rownames(expr_b) <- expr_b[,1]
expr_b <- expr_b[,-1,drop=F]
zero_counts <- apply(expr_b, 1, function(row) sum(row == 0))
save <- which(zero_counts<sort(zero_counts)[1501])
expr_filter <- expr_b[save,]
#expr_filter <- expr_b
# write.csv(d,file = "D:\\Academic\\A_Molecular_Interaction_Tree\\Data\\äººä½“æ³›ç»„ç»‡\\Stomach_top1000_normalized_expression.csv")
###Import Data---------------------
gene_name <- rownames(expr_filter)
ppi_A <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\All\\è›‹ç™½è´¨äº’ä½œ.csv")
ppi_filter <- ppi_A %>%
filter(`InteractorA` %in% gene_name & `InteractorB` %in% gene_name)
library(dpylr)
library(dplyr)
gene_name <- rownames(expr_filter)
ppi_A <- read.csv("D:\\Academic\\A_Molecular_Interaction_Tree\\Empirical_Analysis\\Singal_Cell\\Data\\All\\è›‹ç™½è´¨äº’ä½œ.csv")
ppi_filter <- ppi_A %>%
filter(`InteractorA` %in% gene_name & `InteractorB` %in% gene_name)
g <- length(gene_name)
Y_ppi <- matrix(0, nrow = g, ncol = g)
rownames(Y_ppi) <- gene_name
colnames(Y_ppi) <- gene_name
for (i in 1:nrow(ppi_filter)) {
element_1 <- ppi_filter$InteractorA[i]
element_2 <- ppi_filter$InteractorB[i]
idx1 <- which(gene_name == element_1)
idx2 <- which(gene_name == element_2)
Y_ppi[idx1, idx2] <- 1
Y_ppi[idx2, idx1] <- 1
}
diag(Y_ppi) <- 0
#############å®šä½
#########åŸºå› è¡¨è¾¾æ•°æ®
Y_expr <- cor(t(expr_filter), method = "spearman")
diag(Y_expr) <- 0
threshold <- 0.2  # å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼ˆå¦‚0.15ã€0.25ï¼‰
network_matrix <- ifelse(abs(Y_expr) > threshold, 1, 0)
diag(network_matrix )/2
threshold <- 0.2  # å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼ˆå¦‚0.15ã€0.25ï¼‰
network_matrix <- ifelse(abs(Y_expr) > threshold, 1, 0)
sum(network_matrix )/2
X_sim <- network_matrix
sum(X_sim)/2
sum(X_sim & Y_ppi)/2
sum(X_sim & Y_ppi)/sum(Y_ppi)
(sum(X_sim & Y_ppi)+sum(!X_sim & !Y_ppi))/(ncol(X_sim)*(ncol(X_sim)-1))
setwd("D:\\Academic\\Treegraph")
library(devtools)
devtools::document()
file.rename("DESCRIPTION.txt", "DESCRIPTION")
devtools::document()
devtools::document()
library(TreeGraph)
?tree_graph_analysis
# åˆ é™¤æ‰€æœ‰ç”Ÿæˆçš„æ–‡æ¡£æ–‡ä»¶
unlink("man", recursive = TRUE)
dir.create("man")
# é‡æ–°ç”Ÿæˆæ–‡æ¡£
devtools::document()
library(TreeGraph)
?tree_graph_analysis
unlink("man", recursive = TRUE)
unlink("NAMESPACE")
# 2. åˆ é™¤DESCRIPTIONä¸­çš„RoxygenNoteè¡Œï¼ˆå¦‚æœæœ‰ï¼‰
desc <- readLines("DESCRIPTION")
desc <- desc[!grepl("^RoxygenNote:", desc)]
writeLines(desc, "DESCRIPTION")
# 3. é‡æ–°ç”Ÿæˆæ–‡æ¡£
devtools::document()
if(file.exists("man/tree_graph_analysis.Rd")) {
rd_content <- readLines("man/tree_graph_analysis.Rd")
cat("=== Rdæ–‡ä»¶å†…å®¹ ===\n")
cat(rd_content, sep = "\n")
# ç‰¹åˆ«æŸ¥çœ‹é—®é¢˜åŒºåŸŸ
cat("\n=== é—®é¢˜åŒºåŸŸ (45-80è¡Œ) ===\n")
if(length(rd_content) >= 80) {
cat(rd_content[45:80], sep = "\n")
}
}
# æ£€æŸ¥å½“å‰ä¼šè¯çš„ç¼–ç 
Sys.getlocale()
# å°è¯•è®¾ç½®UTF-8ç¼–ç 
Sys.setlocale(category = "LC_ALL", locale = "en_US.UTF-8")
# é‡æ–°ç”Ÿæˆæ–‡æ¡£
devtools::document()
library(TreeGraph)
.show_help()
?tree_graph_analysis
library(TreeGraph)
# æµ‹è¯•æ•°æ®ç”Ÿæˆ
test_data <- generate_tree_data(n_samples = 50)
print("æµ‹è¯•æ•°æ®ç”Ÿæˆ:")
print(head(test_data))
print(dim(test_data))
# æµ‹è¯•åŸºæœ¬åˆ†æåŠŸèƒ½
print("æµ‹è¯•åŸºæœ¬åˆ†æ:")
result1 <- tree_graph_analysis(data = test_data,
coverage = 0.95,
angle_method = "mean")
print(result1)
# æµ‹è¯•ä¸åŒè§’åº¦æ–¹æ³•
print("æµ‹è¯•ä¸­ä½æ•°æ–¹æ³•:")
result2 <- tree_graph_analysis(data = test_data,
coverage = 0.9,
angle_method = "median")
print(result2)
# å®Œå…¨æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆ
unlink("man", recursive = TRUE)
dir.create("man")
unlink("NAMESPACE")
# é‡æ–°ç”Ÿæˆæ–‡æ¡£
devtools::document()
# é‡æ–°å®‰è£…
devtools::install()
# æµ‹è¯•å¸®åŠ©
library(TreeGraph)
?tree_graph_analysis
?tree_graph_analysis
# è®¾ç½®å·¥ä½œç›®å½•åˆ°åŒ…æ ¹ç›®å½•
setwd("D:/Academic/Treegraph")
# åˆ›å»ºREADME.mdæ–‡ä»¶ - ä¿®æ­£ç‰ˆæœ¬
writeLines('# TreeGraph R Package
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
An R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## ğŸ“¦ Installation
You can install the development version from GitHub:
```r
# Install from GitHub
devtools::install_github("YOUR_USERNAME/TreeGraph")
# Load the package
library(TreeGraph)
# è®¾ç½®å·¥ä½œç›®å½•åˆ°åŒ…æ ¹ç›®å½•ï¼ˆæ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ï¼‰
setwd("D:/Academic/Treegraph")
# åˆ›å»ºREADME.mdæ–‡ä»¶ - ä¿®æ­£ç‰ˆæœ¬
writeLines('# TreeGraph R Package
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
An R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## ğŸ“¦ Installation
You can install the development version from GitHub:
```r
# å®‰è£…å‰ç¡®ä¿å·²å®‰è£…devtools
if (!require("devtools")) install.packages("devtools")
# æ›¿æ¢YOUR_GITHUB_USERNAMEä¸ºä½ çš„GitHubç”¨æˆ·åï¼ˆä¾‹å¦‚"username/Treegraph"ï¼‰
devtools::install_github("YOUR_GITHUB_USERNAME/Treegraph")
# åŠ è½½åŒ…ï¼ˆæ³¨æ„åŒ…åå¤§å°å†™ä¸å®é™…åŒ…åä¸€è‡´ï¼Œæ­¤å¤„ä¸ç›®å½•åTreegraphä¿æŒä¸€è‡´ï¼‰
library(Treegraph)
# è®¾ç½®å·¥ä½œç›®å½•åˆ°åŒ…æ ¹ç›®å½•ï¼ˆæ ¹æ®å®é™…è·¯å¾„è°ƒæ•´ï¼‰
setwd("D:/Academic/Treegraph")
# åˆ›å»ºREADME.mdæ–‡ä»¶ - ä¿®æ­£ç‰ˆæœ¬
setwd("D:/Academic/Treegraph")
setwd("D:/Academic/Treegraph")
# åˆ›å»ºREADME.mdå†…å®¹
readme_content <- "# TreeGraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
""
# åˆ›å»ºREADME.mdå†…å®¹
readme_content <- "# TreeGraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods."
setwd("D:/Academic/Treegraph")
readme_content <- "# TreeGraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## Installation
```r
# Install from GitHub
devtools::install_github(\"YOUR_USERNAME/TreeGraph\")
# Load the package
library(TreeGraph)"
writeLines(readme_content, "README.md")
setwd("D:/Academic/Treegraph")
readme_content <- "# TreeGraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## Installation
```r
# Install from GitHub
devtools::install_github(\"LSX-69/Treegraph\")
# Load the package
library(TreeGraph)"
writeLines(readme_content, "README.md")
setwd("D:/Academic/Treegraph")
readme_content <- "# Treegraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## Installation
```r
# Install from GitHub
devtools::install_github(\"LSX-69/Treegraph\")
# Load the package
library(Treegraph)"
writeLines(readme_content, "README.md")
system('git config --global user.name "LiuSX-69"')
system('git config --global user.email "909925188@qq.com"')
setwd("D:/Academic/Treegraph")
readme_content <- "# Treegraph R Package
R package for analyzing angle statistics in tree-structured graphs with customizable coverage levels and angle calculation methods.
## Installation
```r
# Install from GitHub
devtools::install_github(\"LiuSX-69/Treegraph\")
# Load the package
library(Treegraph)"
writeLines(readme_content, "README.md")
